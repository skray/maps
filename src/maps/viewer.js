var L = require('leaflet');
require('leaflet-draw');

L.Icon.Default.imagePath = 'images';

var map;
var mapData = {'lewisandclark': {"id":"lewisandclark.json","name":"Lewis and Clark's Expedition","center":[38.804967,-90.113183],"zoom":11,"line":[{"lat":46.195042108660154,"lng":-123.85986328124999},{"lat":46.1912395780416,"lng":-123.39294433593749},{"lat":46.11132565729796,"lng":-122.92053222656249},{"lat":45.6101948758674,"lng":-122.65686035156249},{"lat":45.57944511437787,"lng":-122.11303710937499},{"lat":45.71385093029221,"lng":-121.4044189453125},{"lat":45.6716438522655,"lng":-120.860595703125},{"lat":45.744526980468436,"lng":-120.14648437499999},{"lat":46.01222384063238,"lng":-118.97644042968749},{"lat":46.20644812194458,"lng":-119.02587890624999},{"lat":46.41892578708076,"lng":-118.63586425781249},{"lat":46.59661864884465,"lng":-118.3282470703125},{"lat":46.60794102560568,"lng":-117.93273925781249},{"lat":46.68336307047754,"lng":-117.52624511718749},{"lat":46.55886030311719,"lng":-117.2735595703125},{"lat":46.44164232762498,"lng":-117.103271484375},{"lat":46.50973514453879,"lng":-116.6748046875},{"lat":46.50595444552051,"lng":-116.34796142578125},{"lat":46.55319428348575,"lng":-116.26007080078125},{"lat":46.6286925708375,"lng":-116.25457763671875},{"lat":46.616431255357995,"lng":-116.07604980468749},{"lat":46.838588977090446,"lng":-115.86868286132812},{"lat":46.86300803236458,"lng":-115.70114135742186},{"lat":46.83483121393449,"lng":-115.521240234375},{"lat":46.800059446787316,"lng":-114.2138671875},{"lat":45.17913284309501,"lng":-113.89320373535155},{"lat":45.090005109822684,"lng":-113.72360229492188},{"lat":44.969656023708175,"lng":-113.6432647705078},{"lat":44.97985668054508,"lng":-112.87284851074219},{"lat":45.144273362849326,"lng":-112.71217346191406},{"lat":45.45097917473748,"lng":-112.39219665527344},{"lat":45.740693395533064,"lng":-112.19512939453125},{"lat":45.8536734968093,"lng":-111.9232177734375},{"lat":45.99028307184292,"lng":-111.43569946289062},{"lat":46.50973514453879,"lng":-111.5716552734375},{"lat":47.01678007415223,"lng":-112.00424194335938},{"lat":47.523692641902464,"lng":-111.27090454101562},{"lat":48.019324184801185,"lng":-110.2642822265625},{"lat":47.7097615426664,"lng":-109.8028564453125},{"lat":47.78363463526376,"lng":-109.16839599609374},{"lat":47.67278567576541,"lng":-107.08099365234375},{"lat":48.1367666796927,"lng":-102.89794921875},{"lat":47.60616304386874,"lng":-102.23876953125},{"lat":47.55428670127958,"lng":-101.524658203125},{"lat":46.5739667965278,"lng":-100.557861328125},{"lat":45.5679096098613,"lng":-100.4150390625},{"lat":44.512176171071054,"lng":-100.535888671875},{"lat":43.67581809328344,"lng":-99.349365234375},{"lat":42.867912483915305,"lng":-98.20678710937499},{"lat":42.601619944327965,"lng":-96.70166015624999},{"lat":40.216635475391215,"lng":-95.4766845703125},{"lat":39.791654835253425,"lng":-94.90264892578125},{"lat":39.230125638383925,"lng":-94.24346923828125},{"lat":39.20671884491848,"lng":-93.72711181640625},{"lat":39.22799807055236,"lng":-92.85919189453125},{"lat":38.976492485539424,"lng":-92.65869140625},{"lat":38.56105262446978,"lng":-92.1148681640625},{"lat":38.70694605159386,"lng":-91.69464111328125},{"lat":38.67907761983558,"lng":-91.27166748046875},{"lat":38.57179019417365,"lng":-90.8404541015625},{"lat":38.85735483470024,"lng":-90.44357299804688},{"lat":38.891300048305396,"lng":-90.32100677490234},{"lat":38.89023115500578,"lng":-90.30487060546875},{"lat":38.88622266187655,"lng":-90.29045104980469},{"lat":38.873661252078065,"lng":-90.27671813964844},{"lat":38.865374851611634,"lng":-90.27259826660156},{"lat":38.85575072276979,"lng":-90.26504516601562},{"lat":38.849333913235476,"lng":-90.252685546875},{"lat":38.83756825896614,"lng":-90.2252197265625},{"lat":38.82312593339483,"lng":-90.20118713378906},{"lat":38.81884616311726,"lng":-90.18917083740234},{"lat":38.81911365629543,"lng":-90.17887115478516},{"lat":38.82392836168541,"lng":-90.16822814941405},{"lat":38.8284752845139,"lng":-90.15724182128906},{"lat":38.82981255949193,"lng":-90.14522552490233},{"lat":38.82820782650376,"lng":-90.13698577880858},{"lat":38.82446330885513,"lng":-90.13011932373047},{"lat":38.81296105899589,"lng":-90.11810302734375}]}};

init();

function init() {
    buildMap(mapData[getQueryParams().id]);
}

function buildMap(currentMapData) {

    //mapquest
    // map = L.map('map', {
    //     layers: MQ.mapLayer(),
    //     center: center,
    //     zoom: initialZoom
    // });
    //mapbox
    map = L.map('map').setView(currentMapData.center, currentMapData.zoom);

    L.tileLayer('http://{s}.tiles.mapbox.com/v3/seankennethray.map-zjkq5g6o/{z}/{x}/{y}.png', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        maxZoom: 18
    }).addTo(map);

    if(currentMapData.line) {
        map.addLayer(new L.polyline(currentMapData.line));
    };
}

function getQueryParams() {
    var query_string = {};
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    for (var i=0;i<vars.length;i++) {
        var pair = vars[i].split("=");
        if (typeof query_string[pair[0]] === "undefined") {
          query_string[pair[0]] = pair[1];
        } else if (typeof query_string[pair[0]] === "string") {
          var arr = [ query_string[pair[0]], pair[1] ];
          query_string[pair[0]] = arr;
        } else {
          query_string[pair[0]].push(pair[1]);
        }
    }
    return query_string;
}